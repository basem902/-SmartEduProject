<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø±ÙˆØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ - SmartEdu">
    
    <title>Ø§Ù†Ø¶Ù… Ù„Ù„Ù‚Ø±ÙˆØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ - SmartEdu</title>
    <meta name="description" content="Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ù‚Ø±ÙˆØ¨ Telegram Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/assets/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/base.css">
    <link rel="stylesheet" href="/assets/css/join.css">
    <link rel="stylesheet" href="/assets/css/mobile-responsive.css">
</head>
<body data-theme="dark" data-page-type="default">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="screen active">
        <div class="loading-container">
            <div class="spinner"></div>
            <h2 class="loading-title">SmartEdu</h2>
            <p class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <!-- Password Screen -->
    <div id="passwordScreen" class="screen">
        <div class="container">
            <div class="welcome-header">
                <div class="logo">ğŸ”</div>
                <h1>Ø±Ø§Ø¨Ø· Ù…Ø­Ù…ÙŠ</h1>
                <p class="subtitle">Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØªØ·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</p>
            </div>

            <form id="passwordForm">
                <div class="form-group">
                    <label for="passwordInput">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                </div>

                <button type="submit" class="btn-primary">ØªØ­Ù‚Ù‚ â†’</button>
            </form>

            <p id="passwordError" style="color: #ff4444; text-align: center; margin-top: 20px; display: none;"></p>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="screen">
        <div class="container">
            <div class="welcome-header">
                <div class="logo">ğŸ“</div>
                <h1>SmartEdu</h1>
                <p class="subtitle">Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø°ÙƒÙŠØ©</p>
            </div>

            <div class="teacher-info">
                <p class="teacher-name" id="teacherName">...</p>
                <p class="school-name" id="schoolName">...</p>
                <p class="subject-name" id="subjectName">...</p>
            </div>

            <div class="welcome-message">
                <h2>ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                <p id="welcomeText">
                    Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© SmartEdu Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©<br>
                    ÙŠØ³Ø¹Ø¯Ù†Ø§ Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø±ÙˆØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¹Ù„Ù‰ Telegram
                </p>
            </div>

            <button class="btn-primary" id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ â†’</button>
        </div>
    </div>

    <!-- Registration Screen -->
    <div id="registrationScreen" class="screen">
        <div class="container">
            <div class="form-header">
                <h2>ğŸ“ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
                <p class="form-description">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ØªØ³Ø¬ÙŠÙ„</p>
            </div>

            <form id="registrationForm">
                <div class="form-group">
                    <label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                    <input type="text" id="fullName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø­Ø³Ù†" required minlength="6">
                    <p class="input-hint">ğŸ’¡ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (Ø§Ø³Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)</p>
                </div>

                <div class="form-group">
                    <label for="gradeSelect">Ø§Ù„ØµÙ *</label>
                    <select id="gradeSelect" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sectionSelect">Ø§Ù„Ø´Ø¹Ø¨Ø© *</label>
                    <select id="sectionSelect" required disabled>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="backBtn">â† Ø±Ø¬ÙˆØ¹</button>
                    <button type="submit" class="btn-primary" id="submitBtn" disabled>Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Screen -->
    <div id="successScreen" class="screen">
        <div class="container">
            <div class="success-animation">
                <div class="success-icon">âœ…</div>
                <h2 class="success-title">ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h2>
            </div>

            <div class="student-card">
                <h3>Ø´ÙƒØ±Ø§Ù‹ <span id="studentNameDisplay">...</span></h3>
                <div class="student-details">
                    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="confirmedName">...</span></p>
                    <p><strong>Ø§Ù„ØµÙ:</strong> <span id="confirmedGrade">...</span></p>
                    <p><strong>Ø§Ù„Ø´Ø¹Ø¨Ø©:</strong> <span id="confirmedSection">...</span></p>
                </div>
            </div>

            <div id="telegramSection" class="telegram-section" style="display: none;">
                <h3>ğŸ“± Ù‚Ø±ÙˆØ¨Ùƒ Ø¹Ù„Ù‰ Telegram</h3>
                <p class="telegram-description">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù† Ù„Ù„Ù‚Ø±ÙˆØ¨ Ù„Ù„Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ù…Ù‡Ø§Ù…</p>
                
                <div class="telegram-card">
                    <div class="group-name" id="groupName">...</div>
                    <div class="telegram-actions">
                        <button class="btn-copy" id="copyBtn" onclick="copyLink()">
                            ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
                        </button>
                        <a class="btn-open" id="openBtn" href="#" target="_blank">
                            ğŸ”— ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                        </a>
                        <button class="btn-share" id="shareBtn" onclick="shareLink()">
                            ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©
                        </button>
                    </div>
                </div>
            </div>

            <div id="noTelegramSection" class="no-telegram" style="display: none;">
                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø±ÙˆØ¨ ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø¹Ø¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
            </div>
        </div>
    </div>


    <!-- Scripts -->
    <script src="/assets/js/config.js"></script>
    <script>
        const API_URL = window.API_BASE || 'http://localhost:8000/api';
        
        // Get token from URL - Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù€ query parameter Ø«Ù… Ø§Ù„Ù…Ø³Ø§Ø±
        console.log('ğŸŒ Full URL:', window.location.href);
        console.log('ğŸŒ Pathname:', window.location.pathname);
        console.log('ğŸŒ Search:', window.location.search);
        
        const urlParams = new URLSearchParams(window.location.search);
        let token = urlParams.get('token');
        console.log('ğŸ“ Token from query params:', token);
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ ÙÙŠ query parameterØŒ Ø¬Ø±Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±
        if (!token) {
            const pathParts = window.location.pathname.split('/').filter(p => p);
            console.log('ğŸ“ Path parts:', pathParts);
            
            // Ø¢Ø®Ø± Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† .html)
            const lastPart = pathParts[pathParts.length - 1];
            console.log('ğŸ“ Last part:', lastPart);
            
            if (lastPart && !lastPart.includes('.html')) {
                token = lastPart;
                console.log('ğŸ“ Token from path:', token);
            }
        }
        
        console.log('ğŸ” Final extracted token:', token);

        // State
        let teacherData = null;
        let selectedGradeId = null;
        let selectedSectionId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (!token) {
                alert('Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­');
                return;
            }
            loadTeacherInfo();
        });

        // Load teacher info
        async function loadTeacherInfo(password = null) {
            try {
                console.log('ğŸ“¡ Loading teacher info for token:', token);
                const apiUrl = `${API_URL}/sections/join/${token}/info/`;
                console.log('ğŸ“¡ API URL:', apiUrl);
                
                const options = {
                    method: password ? 'POST' : 'GET',
                    headers: {'Content-Type': 'application/json'}
                };
                
                if (password) {
                    options.body = JSON.stringify({ password });
                }
                
                const response = await fetch(apiUrl, options);
                console.log('ğŸ“¡ Response status:', response.status);
                
                const data = await response.json();
                console.log('ğŸ“¡ Response data:', data);
                
                // ğŸ” ÙŠØ­ØªØ§Ø¬ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
                if (data.password_required && !data.success) {
                    showScreen('passwordScreen');
                    if (data.error) {
                        document.getElementById('passwordError').textContent = data.error;
                        document.getElementById('passwordError').style.display = 'block';
                    }
                    return;
                }
                
                if (!data.success) {
                    throw new Error(data.error || 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
                teacherData = data;
                
                // Fill teacher info
                document.getElementById('teacherName').textContent = `Ø§Ù„Ù…Ø¹Ù„Ù…: ${data.teacher.name}`;
                document.getElementById('schoolName').textContent = `ğŸ« ${data.teacher.school}`;
                document.getElementById('subjectName').textContent = `ğŸ“š ${data.teacher.subject}`;
                document.getElementById('welcomeText').innerHTML = data.welcome_message.replace(/\n/g, '<br>');
                
                // Show welcome screen
                showScreen('welcomeScreen');
                
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        // Show screen
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // Password form submit
        document.getElementById('passwordForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            document.getElementById('passwordError').style.display = 'none';
            await loadTeacherInfo(password);
        });

          // Buttons
        document.getElementById('startBtn')?.addEventListener('click', () => {
            // Load grades
            const gradeSelect = document.getElementById('gradeSelect');
            gradeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>';
            
            teacherData.grades.forEach(grade => {
                const option = document.createElement('option');
                option.value = grade.id;
                option.textContent = grade.name;
                option.dataset.sections = JSON.stringify(grade.sections);
                gradeSelect.appendChild(option);
            });
            
            showScreen('registrationScreen');
        });

        document.getElementById('backBtn')?.addEventListener('click', () => {
            showScreen('welcomeScreen');
        });

        // Grade change
        document.getElementById('gradeSelect')?.addEventListener('change', (e) => {
            const sectionSelect = document.getElementById('sectionSelect');
            const submitBtn = document.getElementById('submitBtn');
            
            if (!e.target.value) {
                sectionSelect.disabled = true;
                sectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>';
                submitBtn.disabled = true;
                return;
            }
            
            selectedGradeId = e.target.value;
            const sections = JSON.parse(e.target.selectedOptions[0].dataset.sections);
            
            sectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>';
            sections.forEach(section => {
                const option = document.createElement('option');
                option.value = section.id;
                option.textContent = section.name;
                sectionSelect.appendChild(option);
            });
            
            sectionSelect.disabled = false;
        });

        // Section change
        document.getElementById('sectionSelect')?.addEventListener('change', (e) => {
            const submitBtn = document.getElementById('submitBtn');
            selectedSectionId = e.target.value;
            submitBtn.disabled = !selectedSectionId;
        });

        // Form submit
        document.getElementById('registrationForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fullName = document.getElementById('fullName').value.trim();
            const submitBtn = document.getElementById('submitBtn');
            
            // âœ… Validation - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ
            if (fullName.length < 6) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„');
                return;
            }
            
            const nameParts = fullName.split(' ').filter(p => p.length > 0);
            if (nameParts.length < 4) {
                alert(`Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹ (${nameParts.length}/4)\nÙ…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø­Ø³Ù†`);
                return;
            }
            
            // âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·
            const arabicPattern = /^[\u0600-\u06FF\s]+$/;
            if (!arabicPattern.test(fullName)) {
                alert('Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·');
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            
            // âœ… Step 1: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹
            const verifyData = {
                student_name: fullName,
                section_id: parseInt(selectedSectionId)
            };
            console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø·Ø§Ù„Ø¨:', verifyData);
            
            try {
                const response = await fetch(`${API_URL}/sections/verify-student-join/`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(verifyData)
                });
                
                const data = await response.json();
                console.log('ğŸ“¡ Verify response:', response.status, data);
                
                if (!data.success) {
                    // âŒ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
                    console.error('âŒ Student not found:', data);
                    
                    let errorMessage = data.message || 'Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø¹Ø¨Ø©';
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¥Ù† ÙˆÙØ¬Ø¯Øª
                    if (data.suggestions && data.suggestions.length > 0) {
                        errorMessage += '\n\nğŸ” Ù‡Ù„ ØªÙ‚ØµØ¯ Ø£Ø­Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ØŸ\n';
                        data.suggestions.forEach(s => {
                            errorMessage += `\nâ€¢ ${s.name} (${s.similarity}% ØªØ´Ø§Ø¨Ù‡)`;
                        });
                    }
                    
                    errorMessage += '\n\nğŸ’¡ ' + (data.action || 'ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¹Ù„Ù…Ùƒ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù…Ùƒ');
                    
                    alert(errorMessage);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Ø§Ù„ØªØ§Ù„ÙŠ â†’';
                    return;
                }
                
                // âœ… Ù†Ø¬Ø­ Ø§Ù„ØªØ­Ù‚Ù‚ - Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø±ÙˆØ¨
                console.log('âœ… Student verified:', data.student);
                showSuccessScreen(data);
                
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Ø§Ù„ØªØ§Ù„ÙŠ â†’';
            }
        });

        // Show success screen
        function showSuccessScreen(data) {
            const student = data.student;
            
            document.getElementById('studentNameDisplay').textContent = student.name;
            document.getElementById('confirmedName').textContent = student.name;
            document.getElementById('confirmedGrade').textContent = student.grade;
            document.getElementById('confirmedSection').textContent = student.section;
            
            // Telegram section
            if (data.telegram_group && data.telegram_group.invite_link) {
                const groupName = data.telegram_group.name;
                const inviteLink = data.telegram_group.invite_link;
                
                document.getElementById('groupName').textContent = groupName;
                document.getElementById('openBtn').href = inviteLink;
                
                // Store for copy/share
                window.telegramLink = inviteLink;
                window.groupName = groupName;
                
                document.getElementById('telegramSection').style.display = 'block';
                document.getElementById('noTelegramSection').style.display = 'none';
            } else {
                document.getElementById('telegramSection').style.display = 'none';
                document.getElementById('noTelegramSection').style.display = 'block';
            }
            
            showScreen('successScreen');
            confetti();
        }

        // Copy link
        function copyLink() {
            if (!window.telegramLink) return;
            
            navigator.clipboard.writeText(window.telegramLink).then(() => {
                alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·');
            }).catch(() => {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®');
            });
        }

        // Share link
        async function shareLink() {
            if (!window.telegramLink) return;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: window.groupName || 'Ù‚Ø±ÙˆØ¨ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…',
                        text: 'Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø±ÙˆØ¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ',
                        url: window.telegramLink
                    });
                } catch (err) {
                    console.log('Share cancelled');
                }
            } else {
                copyLink();
            }
        }

        // Confetti animation
        function confetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe'];
            const count = 50;
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const el = document.createElement('div');
                    el.style.position = 'fixed';
                    el.style.width = '10px';
                    el.style.height = '10px';
                    el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    el.style.left = Math.random() * 100 + '%';
                    el.style.top = '-20px';
                    el.style.borderRadius = '50%';
                    el.style.pointerEvents = 'none';
                    el.style.zIndex = '9999';
                    el.style.animation = 'fall 3s linear';
                    document.body.appendChild(el);
                    
                    setTimeout(() => el.remove(), 3000);
                }, i * 30);
            }
        }

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                    opacity: 0;
                }
            }
            .screen { display: none; }
            .screen.active { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        `;
        document.head.appendChild(style);
    </script>

    <!-- âœ… Dark Mode System -->
    <script src="/assets/js/dark-mode-manager.js"></script>
    <script src="/assets/js/dark-mode-init.js"></script>
</body>
</html>    